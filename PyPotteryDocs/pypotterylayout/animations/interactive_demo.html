<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyPotteryLayout Interactive Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .window {
            background: #f5f5f5;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            max-width: 1100px;
            margin: 15px auto;
        }

        .header {
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red {
            background: #ff5f56;
        }

        .dot.yellow {
            background: #ffbd2e;
        }

        .dot.green {
            background: #27c93f;
        }

        .header-title {
            margin-left: auto;
            font-size: 0.85rem;
            color: white;
            font-weight: 500;
        }

        .demo-container {
            display: flex;
        }

        .control-panel {
            width: 300px;
            background: white;
            padding: 20px;
            border-right: 1px solid #e5e7eb;
            max-height: 550px;
            overflow-y: auto;
        }

        .control-panel h6 {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-group label {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 4px;
            display: block;
        }

        .form-control,
        .form-select {
            font-size: 0.85rem;
            border-radius: 6px;
            padding: 6px 10px;
        }

        .btn-group-mode {
            display: flex;
            gap: 5px;
        }

        .btn-group-mode .btn {
            flex: 1;
            font-size: 0.8rem;
            padding: 6px;
            border-radius: 6px;
        }

        .btn-check:checked+.btn-outline-primary {
            background-color: #667eea;
            border-color: #667eea;
            color: white;
        }

        .btn-outline-primary {
            border-color: #667eea;
            color: #667eea;
        }

        .sub-options {
            margin-top: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            display: none;
        }

        .sub-options.visible {
            display: block;
        }

        .value-display {
            font-size: 0.75rem;
            color: #667eea;
            font-weight: 600;
        }

        .form-check {
            font-size: 0.85rem;
        }

        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }

        hr {
            margin: 15px 0;
            border-color: #e5e7eb;
        }

        .preview-area {
            flex: 1;
            background: linear-gradient(145deg, #e8ecef 0%, #d1d8de 100%);
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 550px;
        }

        .paper {
            background: white;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 4px 6px rgba(0, 0, 0, 0.08), 0 10px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .paper::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            border-style: solid;
            border-width: 0 20px 20px 0;
            border-color: transparent #d1d8de transparent transparent;
            z-index: 10;
        }

        .paper-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            position: relative;
        }

        .pottery-item {
            background: linear-gradient(145deg, #c0c5c9 0%, #a0a8ad 100%);
            border-radius: 3px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .pottery-icon {
            font-size: 1.5em;
            opacity: 0.6;
        }

        .item-caption {
            position: absolute;
            bottom: -18px;
            font-size: 8px;
            color: #333;
            text-align: center;
            width: 100%;
        }

        .scale-bar {
            position: absolute;
            bottom: 8px;
            right: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 7px;
            color: #333;
        }

        .scale-bar-line {
            height: 2px;
            background: #333;
            position: relative;
        }

        .scale-bar-line::before,
        .scale-bar-line::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 6px;
            background: #333;
            top: -2px;
        }

        .scale-bar-line::before {
            left: 0;
        }

        .scale-bar-line::after {
            right: 0;
        }

        .table-number {
            position: absolute;
            font-size: 10px;
            font-weight: 600;
            color: #333;
        }

        .margin-indicator {
            position: absolute;
            border: 1px dashed rgba(102, 126, 234, 0.4);
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="window">
        <div class="header">
            <div class="dot red"></div>
            <div class="dot yellow"></div>
            <div class="dot green"></div>
            <span class="header-title">PyPotteryLayout - Interactive Demo</span>
        </div>
        <div class="demo-container">
            <div class="control-panel">
                <h6><i class="bi bi-grid"></i> Layout</h6>
                <div class="control-group">
                    <label>Mode</label>
                    <div class="btn-group-mode">
                        <input type="radio" class="btn-check" name="mode" id="modeGrid" value="grid" checked>
                        <label class="btn btn-outline-primary" for="modeGrid"><i class="bi bi-grid-3x3"></i>
                            Grid</label>
                        <input type="radio" class="btn-check" name="mode" id="modePuzzle" value="puzzle">
                        <label class="btn btn-outline-primary" for="modePuzzle"><i class="bi bi-puzzle"></i>
                            Puzzle</label>
                    </div>
                    <div class="sub-options visible" id="gridOptions">
                        <div class="row">
                            <div class="col-6">
                                <label>Max Rows</label>
                                <input type="number" class="form-control form-control-sm" id="gridRows" value="3"
                                    min="1" max="6">
                            </div>
                            <div class="col-6">
                                <label>Max Columns</label>
                                <input type="number" class="form-control form-control-sm" id="gridCols" value="3"
                                    min="2" max="5">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Page Size</label>
                    <select class="form-select form-select-sm" id="pageSize">
                        <option value="A4">A4</option>
                        <option value="A3">A3</option>
                        <option value="LETTER">Letter</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Scale: <span class="value-display" id="scaleValue">0.50x</span></label>
                    <input type="range" class="form-range" id="scaleFactor" min="0.3" max="1.0" step="0.05" value="0.5">
                </div>
                <div class="control-group">
                    <label>Margins: <span class="value-display" id="marginValue">15px</span></label>
                    <input type="range" class="form-range" id="marginPx" min="5" max="40" step="5" value="15">
                </div>
                <div class="control-group">
                    <label>Spacing: <span class="value-display" id="spacingValue">8px</span></label>
                    <input type="range" class="form-range" id="spacingPx" min="4" max="20" step="2" value="8">
                </div>
                <hr>
                <h6><i class="bi bi-fonts"></i> Annotations</h6>
                <div class="control-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showCaptions" checked>
                        <label class="form-check-label" for="showCaptions">Show Captions</label>
                    </div>
                </div>
                <div class="control-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showScaleBar" checked>
                        <label class="form-check-label" for="showScaleBar">Scale Bar</label>
                    </div>
                    <div class="sub-options" id="scaleBarOptions">
                        <label>Length: <span class="value-display" id="scaleBarValue">5 cm</span></label>
                        <input type="range" class="form-range" id="scaleBarCm" min="1" max="10" step="1" value="5">
                    </div>
                </div>
                <div class="control-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showTableNumber" checked>
                        <label class="form-check-label" for="showTableNumber">Table Number</label>
                    </div>
                    <div class="sub-options" id="tableNumberOptions">
                        <div class="row">
                            <div class="col-6">
                                <label>Prefix</label>
                                <input type="text" class="form-control form-control-sm" id="tablePrefix" value="Tav.">
                            </div>
                            <div class="col-6">
                                <label>Position</label>
                                <select class="form-select form-select-sm" id="tablePosition">
                                    <option value="top_left">Top Left</option>
                                    <option value="top_right">Top Right</option>
                                    <option value="bottom_left">Bottom Left</option>
                                    <option value="bottom_right">Bottom Right</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="preview-area">
                <div class="paper" id="paper">
                    <div class="margin-indicator" id="marginIndicator"></div>
                    <div class="paper-content" id="paperContent"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const paper = document.getElementById('paper');
        const paperContent = document.getElementById('paperContent');
        const marginIndicator = document.getElementById('marginIndicator');
        const gridOptions = document.getElementById('gridOptions');
        const scaleBarOptions = document.getElementById('scaleBarOptions');
        const tableNumberOptions = document.getElementById('tableNumberOptions');

        const modeGrid = document.getElementById('modeGrid');
        const modePuzzle = document.getElementById('modePuzzle');
        const gridRows = document.getElementById('gridRows');
        const gridCols = document.getElementById('gridCols');
        const pageSize = document.getElementById('pageSize');
        const scaleFactor = document.getElementById('scaleFactor');
        const marginPx = document.getElementById('marginPx');
        const spacingPx = document.getElementById('spacingPx');
        const showCaptions = document.getElementById('showCaptions');
        const showScaleBar = document.getElementById('showScaleBar');
        const scaleBarCm = document.getElementById('scaleBarCm');
        const showTableNumber = document.getElementById('showTableNumber');
        const tablePrefix = document.getElementById('tablePrefix');
        const tablePosition = document.getElementById('tablePosition');

        const scaleValue = document.getElementById('scaleValue');
        const marginValue = document.getElementById('marginValue');
        const spacingValue = document.getElementById('spacingValue');
        const scaleBarValue = document.getElementById('scaleBarValue');

        const pageSizes = {
            'A4': { w: 280, h: 396 },
            'A3': { w: 396, h: 560 },
            'LETTER': { w: 290, h: 374 }
        };

        // Items with fixed aspect ratios and column spans
        const items = [
            { colSpan: 3, aspectRatio: 2.5, name: 'Bowl_001' },
            { colSpan: 2, aspectRatio: 1.2, name: 'Plate_002' },
            { colSpan: 1, aspectRatio: 0.8, name: 'Jar_003' },
            { colSpan: 1, aspectRatio: 1.0, name: 'Cup_004' },
            { colSpan: 1, aspectRatio: 0.7, name: 'Vase_005' },
            { colSpan: 2, aspectRatio: 1.5, name: 'Dish_006' },
            { colSpan: 1, aspectRatio: 1.1, name: 'Pot_007' },
            { colSpan: 1, aspectRatio: 0.9, name: 'Urn_008' },
            { colSpan: 2, aspectRatio: 1.3, name: 'Amphora_009' },
            { colSpan: 1, aspectRatio: 0.85, name: 'Jug_010' },
            { colSpan: 3, aspectRatio: 2.2, name: 'Tray_011' },
            { colSpan: 1, aspectRatio: 1.0, name: 'Mug_012' },
        ];

        const puzzleItems = [
            { w: 0.45, aspectRatio: 2.0, name: 'Bowl_001' },
            { w: 0.25, aspectRatio: 0.8, name: 'Jar_002' },
            { w: 0.28, aspectRatio: 1.2, name: 'Plate_003' },
            { w: 0.35, aspectRatio: 1.5, name: 'Dish_004' },
            { w: 0.20, aspectRatio: 0.7, name: 'Vase_005' },
            { w: 0.30, aspectRatio: 1.0, name: 'Cup_006' },
            { w: 0.22, aspectRatio: 0.9, name: 'Pot_007' },
        ];

        function updatePreview() {
            const mode = modeGrid.checked ? 'grid' : 'puzzle';
            const size = pageSizes[pageSize.value];
            const scale = parseFloat(scaleFactor.value);
            const margin = parseInt(marginPx.value);
            const spacing = parseInt(spacingPx.value);
            const cols = parseInt(gridCols.value);
            const maxRows = parseInt(gridRows.value);

            scaleValue.textContent = scale.toFixed(2) + 'x';
            marginValue.textContent = margin + 'px';
            spacingValue.textContent = spacing + 'px';
            scaleBarValue.textContent = scaleBarCm.value + ' cm';

            gridOptions.classList.toggle('visible', mode === 'grid');
            scaleBarOptions.classList.toggle('visible', showScaleBar.checked);
            tableNumberOptions.classList.toggle('visible', showTableNumber.checked);

            paper.style.width = size.w + 'px';
            paper.style.height = size.h + 'px';

            marginIndicator.style.top = margin + 'px';
            marginIndicator.style.left = margin + 'px';
            marginIndicator.style.width = (size.w - margin * 2) + 'px';
            marginIndicator.style.height = (size.h - margin * 2) + 'px';

            paperContent.innerHTML = '';
            const contentW = size.w - margin * 2;
            paperContent.style.padding = margin + 'px';
            paperContent.style.gap = spacing + 'px';
            const captionOffset = showCaptions.checked ? 22 : 0;

            if (mode === 'grid') {
                const colWidth = (contentW - spacing * (cols - 1)) / cols;
                let currentRow = 0;
                let colsUsedInRow = 0;

                for (let i = 0; i < items.length && currentRow < maxRows; i++) {
                    const item = items[i];
                    const actualColSpan = Math.min(item.colSpan, cols);

                    // Check if item fits in current row
                    if (colsUsedInRow + actualColSpan > cols) {
                        currentRow++;
                        colsUsedInRow = 0;
                        if (currentRow >= maxRows) break;
                    }

                    const baseW = colWidth * actualColSpan + spacing * (actualColSpan - 1);
                    const itemW = baseW * scale;
                    const itemH = itemW / item.aspectRatio;

                    const el = document.createElement('div');
                    el.className = 'pottery-item';
                    el.style.width = itemW + 'px';
                    el.style.height = Math.max(itemH, 20) + 'px';
                    el.style.marginBottom = captionOffset + 'px';

                    const icon = document.createElement('span');
                    icon.className = 'pottery-icon';
                    icon.textContent = 'üè∫';
                    el.appendChild(icon);

                    if (showCaptions.checked) {
                        const caption = document.createElement('div');
                        caption.className = 'item-caption';
                        caption.textContent = item.name;
                        el.appendChild(caption);
                    }

                    paperContent.appendChild(el);
                    colsUsedInRow += actualColSpan;
                }
            } else {
                puzzleItems.forEach(item => {
                    const itemW = contentW * item.w * scale;
                    const itemH = itemW / item.aspectRatio;

                    const el = document.createElement('div');
                    el.className = 'pottery-item';
                    el.style.width = itemW + 'px';
                    el.style.height = Math.max(itemH, 20) + 'px';
                    el.style.marginBottom = captionOffset + 'px';

                    const icon = document.createElement('span');
                    icon.className = 'pottery-icon';
                    icon.textContent = 'üè∫';
                    el.appendChild(icon);

                    if (showCaptions.checked) {
                        const caption = document.createElement('div');
                        caption.className = 'item-caption';
                        caption.textContent = item.name;
                        el.appendChild(caption);
                    }

                    paperContent.appendChild(el);
                });
            }

            if (showScaleBar.checked) {
                const scaleBar = document.createElement('div');
                scaleBar.className = 'scale-bar';
                const lineWidth = parseInt(scaleBarCm.value) * 10 * scale;
                scaleBar.innerHTML = '<div class="scale-bar-line" style="width:' + lineWidth + 'px"></div><span>' + scaleBarCm.value + ' cm</span>';
                paperContent.appendChild(scaleBar);
            }

            if (showTableNumber.checked) {
                const tableNum = document.createElement('div');
                tableNum.className = 'table-number';
                tableNum.textContent = tablePrefix.value + ' 1';
                const pos = tablePosition.value;
                if (pos.includes('top')) tableNum.style.top = (margin + 5) + 'px';
                if (pos.includes('bottom')) tableNum.style.bottom = (margin + 5) + 'px';
                if (pos.includes('left')) tableNum.style.left = (margin + 5) + 'px';
                if (pos.includes('right')) tableNum.style.right = (margin + 5) + 'px';
                paperContent.appendChild(tableNum);
            }
        }

        [modeGrid, modePuzzle, showCaptions, showScaleBar, showTableNumber].forEach(el => el.addEventListener('change', updatePreview));
        [gridRows, gridCols, pageSize, tablePosition].forEach(el => el.addEventListener('change', updatePreview));
        [scaleFactor, marginPx, spacingPx, scaleBarCm].forEach(el => el.addEventListener('input', updatePreview));
        tablePrefix.addEventListener('input', updatePreview);

        updatePreview();
    </script>
</body>

</html>